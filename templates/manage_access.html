<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Manage Admin Access</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body>
<div class="container my-4">
  <h3>Manage Admin Access</h3>
  <div id="alertPlaceholder"></div>

  <div class="card mb-3">
    <div class="card-header">Add / Edit Admin</div>
    <div class="card-body">
      <form id="adminForm">
        <div class="row g-2">
          <div class="col-md-5">
            <input type="email" class="form-control" id="adminEmail" placeholder="admin@example.com" required>
          </div>
          <div class="col-md-4">
            <input type="password" class="form-control" id="adminPassword" placeholder="Password" required>
          </div>
          <div class="col-md-3">
            <button class="btn btn-primary w-100" id="adminBtn">Add / Update</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-header d-flex justify-content-between">
      <span>Admins List</span>
      <button id="refreshAdmins" class="btn btn-outline-secondary btn-sm">Refresh</button>
    </div>
    <div class="card-body table-responsive">
      <table class="table table-striped table-bordered" id="adminsTable">
        <thead>
          <tr>
            <th>Email</th>
            <th>Is Admin</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Populated dynamically -->
        </tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
function showAlert(type, msg, timeout=4000){
  const id = 'a'+Math.random().toString(36).slice(2,9);
  const el = $('<div id="'+id+'" class="alert alert-'+type+' alert-dismissible fade show" role="alert">'+msg+
               '<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>');
  $('#alertPlaceholder').append(el);
  if(timeout>0) setTimeout(()=>el.alert('close'), timeout);
}

function loadAdmins(){
  $.getJSON('/admin/list').done(function(data){
    if(data.status==='success'){
      const tbody = data.admins.map(a => `
        <tr data-email="${a.email}">
          <td>${a.email}</td>
          <td>${a.is_admin}</td>
          <td>
            <button class="btn btn-sm btn-warning editBtn">Edit</button>
            <button class="btn btn-sm btn-danger deleteBtn">Delete</button>
          </td>
        </tr>`).join('');
      $('#adminsTable tbody').html(tbody);
    } else {
      showAlert('danger','Failed to load admins');
    }
  });
}

$(document).ready(function(){
  loadAdmins();

  $('#refreshAdmins').on('click', loadAdmins);

  $('#adminForm').on('submit', function(e){
    e.preventDefault();
    const email = $('#adminEmail').val().trim();
    const password = $('#adminPassword').val().trim();
    if(!email || !password){ showAlert('warning','Email and password required'); return; }
    
    $.post('/admin/add_update', {email,password})
      .done(function(data){
        if(data.status==='success'){ showAlert('success', data.message); loadAdmins(); }
        else showAlert('danger', data.message);
      });
  });

  $('#adminsTable').on('click', '.editBtn', function(){
    const tr = $(this).closest('tr');
    const email = tr.data('email');
    $('#adminEmail').val(email);
  });

  $('#adminsTable').on('click', '.deleteBtn', function(){
    const tr = $(this).closest('tr');
    const email = tr.data('email');
    if(confirm(`Delete admin ${email}?`)){
      $.post('/admin/delete', {email}).done(function(data){
        if(data.status==='success'){ showAlert('success', data.message); loadAdmins(); }
        else showAlert('danger', data.message);
      });
    }
  });
});
</script>
</body>
</html>















